box: wercker/php
services:
  - duythien/rethinkdb@0.2.0
build:
  steps:
    - script:
        name: Add php.ini
        code: echo 'extension=phalcon.so' >> $HOME/.phpenv/versions/$(phpenv version-name)/etc/php.ini
    - script:
        name: install dependencies
        code: composer self-update
    - script:
        name: Serve application for integration tests
        code: php -S localhost:8000 >> /dev/null &
    - script:
        name: PHPUnit integration tests
        code: phpunit --configuration phpunit.xml
  #send messages into hipchat
  after-steps:
    - hipchat-notify:
        token: xHJ8scOlvz3hatcWsZPahRzFljKjwtpOQPXvkXl5
        room-id: 1089715
        from-name: wercker
